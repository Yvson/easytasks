from celery import Celery
from celery.schedules import crontab
from celery import shared_task

from django.utils.timezone import now
from django.core.management.base import BaseCommand
from cotacoes.models import Cryptocurrency
from cotacoes.models import Currency

import requests
from requests import ConnectionError
from pycoingecko import CoinGeckoAPI
from datetime import timedelta


# Basic Info
currency_pairs = ['EUR-AFN', 'USD-AFN', 'EUR-MGA', 'USD-MGA', 'BRL-THB', 'EUR-THB', 'USD-THB', 'BRL-PAB', 'EUR-PAB', 'USD-PAB', 'EUR-ETB', 'USD-ETB', 'BRL-VEF', 'EUR-VEF', 'USD-VEF', 'BRL-BOB', 'EUR-BOB', 'USD-BOB', 'EUR-GHS', 'USD-GHS', 'EUR-CRC', 'USD-CRC', 'EUR-SVC', 'USD-SVC', 'EUR-NIO', 'USD-NIO', 'BRL-CZK', 'EUR-CZK', 'USD-CZK', 'BRL-DKK', 'EUR-DKK', 'USD-DKK', 'BRL-ISK', 'EUR-ISK', 'USD-ISK', 'BRL-NOK', 'EUR-NOK', 'USD-NOK', 'BRL-SEK', 'EUR-SEK', 'USD-SEK', 'EUR-GMD', 'USD-GMD', 'EUR-MKD', 'USD-MKD', 'EUR-DZD', 'USD-DZD', 'BRL-BHD', 'EUR-BHD', 'USD-BHD', 'EUR-IQD', 'USD-IQD', 'BRL-JOD', 'EUR-JOD', 'USD-JOD', 'EUR-KWD', 'USD-KWD', 'EUR-LYD', 'USD-LYD', 'EUR-RSD', 'USD-RSD', 'EUR-TND', 'USD-TND', 'BRL-AED', 'EUR-AED', 'USD-AED', 'BRL-MAD', 'EUR-MAD', 'USD-MAD', 'EUR-STD', 'AED-USD', 'AFN-USD', 'ARS-USD', 'AUD-USD', 'BOB-USD', 'BRL-USD', 'BYN-USD', 'CAD-USD', 'CHF-USD', 'CLP-USD', 'CNY-USD', 'COP-USD', 'DKK-USD', 'EGP-USD', 'EUR-USD', 'FJD-USD', 'GBP-USD', 'GHS-USD', 'HKD-USD', 'HUF-USD', 'IDR-USD', 'ILS-USD', 'INR-USD', 'IQD-USD', 'IRR-USD', 'JOD-USD', 'JPY-USD', 'KRW-USD', 'KWD-USD', 'KYD-USD', 'MXN-USD', 'MYR-USD', 'NIO-USD', 'NOK-USD', 'NZD-USD', 'PEN-USD', 'PHP-USD', 'PLN-USD', 'PYG-USD', 'RUB-USD', 'SAR-USD', 'SEK-USD', 'SGD-USD', 'SYP-USD', 'THB-USD', 'TRY-USD', 'TWD-USD', 'UAH-USD', 'UYU-USD', 'VND-USD', 'XBR-USD', 'ZAR-USD', 'BRL-AUD', 'EUR-AUD', 'USD-AUD', 'BRL-CAD', 'EUR-CAD', 'USD-CAD', 'EUR-BSD', 'USD-BSD', 'EUR-KYD', 'BRL-BBD', 'EUR-BBD', 'USD-BBD', 'EUR-BZD', 'USD-BZD', 'EUR-BND', 'USD-BND', 'BRL-SGD', 'EUR-SGD', 'USD-SGD', 'EUR-FJD', 'USD-FJD', 'BRL-HKD', 'EUR-HKD', 'USD-HKD', 'EUR-TTD', 'USD-TTD', 'BRL-XCD', 'EUR-XCD', 'USD-XCD', 'BRL-JMD', 'EUR-JMD', 'USD-JMD', 'BRL-NAD', 'EUR-NAD', 'USD-NAD', 'BRL-NZD', 'EUR-NZD', 'USD-NZD', 'BRL-TWD', 'EUR-TWD', 'USD-TWD', 'USD-ZWL', 'EUR-VND', 'USD-VND', 'EUR-AMD', 'USD-AMD', 'EUR-CVE', 'AED-EUR', 'ARS-EUR', 'AUD-EUR', 'BHD-EUR', 'BRL-EUR', 'BYN-EUR', 'CAD-EUR', 'CHF-EUR', 'CNY-EUR', 'DKK-EUR', 'EGP-EUR', 'GBP-EUR', 'GEL-EUR', 'GHS-EUR', 'HKD-EUR', 'HUF-EUR', 'IDR-EUR', 'ILS-EUR', 'INR-EUR', 'JOD-EUR', 'JPY-EUR', 'KRW-EUR', 'KWD-EUR', 'MAD-EUR', 'MXN-EUR', 'NOK-EUR', 'NZD-EUR', 'PEN-EUR', 'PLN-EUR', 'RUB-EUR', 'SAR-EUR', 'SEK-EUR', 'SGD-EUR', 'TRY-EUR', 'TWD-EUR', 'USD-EUR', 'ZAR-EUR', 'BRL-HUF', 'EUR-HUF', 'USD-HUF', 'EUR-BIF', 'USD-BIF', 'BRL-XAF', 'EUR-XAF', 'USD-XAF', 'BRL-XOF', 'EUR-XOF', 'USD-XOF', 'EUR-XPF', 'USD-XPF', 'USD-KMF', 'EUR-GNF', 'USD-GNF', 'EUR-DJF', 'EUR-RWF', 'USD-RWF', 'BRL-CHF', 'EUR-CHF', 'USD-CHF', 'EUR-HTG', 'USD-HTG', 'BRL-PYG', 'EUR-PYG', 'USD-PYG', 'EUR-ANG', 'USD-ANG', 'EUR-UAH', 'USD-UAH', 'BRL-JPY', 'EUR-JPY', 'USD-JPY', 'EUR-PGK', 'USD-PGK', 'EUR-LAK', 'USD-LAK', 'EUR-HRK', 'USD-HRK', 'EUR-MWK', 'USD-MWK', 'EUR-ZMK', 'USD-ZMK', 'EUR-AOA', 'USD-AOA', 'EUR-MMK', 'USD-MMK', 'EUR-GEL', 'USD-GEL', 'EUR-ALL', 'USD-ALL', 'EUR-HNL', 'USD-HNL', 'EUR-MDL', 'USD-MDL', 'BRL-RON', 'EUR-RON', 'USD-RON', 'EUR-BGN', 'USD-BGN', 'BRL-EGP', 'EUR-EGP', 'USD-EGP', 'BRL-GBP', 'EUR-GBP', 'USD-GBP', 'BRL-LBP', 'EUR-LBP', 'USD-LBP', 'EUR-SYP', 'USD-SYP', 'EUR-SDG', 'USD-SDG', 'EUR-SZL', 'USD-SZL', 'EUR-LSL', 'USD-LSL', 'EUR-AZN', 'USD-AZN', 'EUR-BAM', 'EUR-MZN', 'USD-MZN', 'USD-MNT', 'EUR-NGN', 'USD-NGN', 'USD-NGNI', 'BRL-TRY', 'EUR-TRY', 'USD-TRY', 'BRL-ILS', 'EUR-ILS', 'USD-ILS', 'EUR-MRO', 'EUR-MOP', 'USD-MOP', 'BRL-ARS', 'EUR-ARS', 'USD-ARS', 'BRL-CLP', 'EUR-CLP', 'USD-CLP', 'BRL-COP', 'EUR-COP', 'USD-COP', 'EUR-CUP', 'USD-CUP', 'EUR-DOP', 'USD-DOP', 'BRL-PHP', 'EUR-PHP', 'USD-PHP', 'BRL-MXN', 'EUR-MXN', 'USD-MXN', 'BRL-UYU', 'EUR-UYU', 'USD-UYU', 'EUR-BWP', 'USD-BWP', 'EUR-GTQ', 'USD-GTQ', 'BRL-ZAR', 'EUR-ZAR', 'USD-ZAR', 'AED-BRL', 'ARS-BRL', 'AUD-BRL', 'BOB-BRL', 'CAD-BRL', 'CHF-BRL', 'CLP-BRL', 'CNY-BRL', 'COP-BRL', 'DKK-BRL', 'EUR-BRL', 'GBP-BRL', 'HKD-BRL', 'ILS-BRL', 'INR-BRL', 'JPY-BRL', 'MXN-BRL', 'NOK-BRL', 'NZD-BRL', 'PEN-BRL', 'PLN-BRL', 'PYG-BRL', 'RUB-BRL', 'SAR-BRL', 'SEK-BRL', 'SGD-BRL', 'THB-BRL', 'TRY-BRL', 'TWD-BRL', 'USD-BRL', 'UYU-BRL', 'ZAR-BRL', 'USD-BRLT', 'BRL-QAR', 'EUR-QAR', 'USD-QAR', 'EUR-IRR', 'USD-IRR', 'BRL-OMR', 'EUR-OMR', 'USD-OMR', 'EUR-KHR', 'USD-KHR', 'BRL-MYR', 'EUR-MYR', 'USD-MYR', 'USD-YER', 'BRL-SAR', 'EUR-SAR', 'USD-SAR', 'EUR-BYN', 'USD-BYN', 'BRL-RUB', 'EUR-RUB', 'USD-RUB', 'USD-MVR', 'BRL-LKR', 'EUR-LKR', 'USD-LKR', 'BRL-INR', 'EUR-INR', 'USD-INR', 'BRL-IDR', 'EUR-IDR', 'USD-IDR', 'EUR-MUR', 'USD-MUR', 'BRL-NPR', 'EUR-NPR', 'USD-NPR', 'BRL-PKR', 'EUR-PKR', 'USD-PKR', 'EUR-SCR', 'USD-SCR', 'BRL-KES', 'EUR-KES', 'USD-KES', 'EUR-SOS', 'USD-SOS', 'EUR-TZS', 'USD-TZS', 'EUR-UGX', 'USD-UGX', 'BRL-PEN', 'EUR-PEN', 'USD-PEN', 'USD-KGS', 'EUR-UZS', 'USD-UZS', 'EUR-TJS', 'USD-TJS', 'EUR-BDT', 'USD-BDT', 'EUR-KZT', 'USD-KZT', 'USD-VUV', 'BRL-KRW', 'EUR-KRW', 'USD-KRW', 'BRL-CNY', 'EUR-CNY', 'USD-CNY', 'USD-CNH', 'BRL-PLN', 'EUR-PLN', 'USD-PLN']
code_pairs = ['EURAFN', 'USDAFN', 'EURMGA', 'USDMGA', 'BRLTHB', 'EURTHB', 'USDTHB', 'BRLPAB', 'EURPAB', 'USDPAB', 'EURETB', 'USDETB', 'BRLVEF', 'EURVEF', 'USDVEF', 'BRLBOB', 'EURBOB', 'USDBOB', 'EURGHS', 'USDGHS', 'EURCRC', 'USDCRC', 'EURSVC', 'USDSVC', 'EURNIO', 'USDNIO', 'BRLCZK', 'EURCZK', 'USDCZK', 'BRLDKK', 'EURDKK', 'USDDKK', 'BRLISK', 'EURISK', 'USDISK', 'BRLNOK', 'EURNOK', 'USDNOK', 'BRLSEK', 'EURSEK', 'USDSEK', 'EURGMD', 'USDGMD', 'EURMKD', 'USDMKD', 'EURDZD', 'USDDZD', 'BRLBHD', 'EURBHD', 'USDBHD', 'EURIQD', 'USDIQD', 'BRLJOD', 'EURJOD', 'USDJOD', 'EURKWD', 'USDKWD', 'EURLYD', 'USDLYD', 'EURRSD', 'USDRSD', 'EURTND', 'USDTND', 'BRLAED', 'EURAED', 'USDAED', 'BRLMAD', 'EURMAD', 'USDMAD', 'EURSTD', 'AEDUSD', 'AFNUSD', 'ARSUSD', 'AUDUSD', 'BOBUSD', 'BRLUSD', 'BYNUSD', 'CADUSD', 'CHFUSD', 'CLPUSD', 'CNYUSD', 'COPUSD', 'DKKUSD', 'EGPUSD', 'EURUSD', 'FJDUSD', 'GBPUSD', 'GHSUSD', 'HKDUSD', 'HUFUSD', 'IDRUSD', 'ILSUSD', 'INRUSD', 'IQDUSD', 'IRRUSD', 'JODUSD', 'JPYUSD', 'KRWUSD', 'KWDUSD', 'KYDUSD', 'MXNUSD', 'MYRUSD', 'NIOUSD', 'NOKUSD', 'NZDUSD', 'PENUSD', 'PHPUSD', 'PLNUSD', 'PYGUSD', 'RUBUSD', 'SARUSD', 'SEKUSD', 'SGDUSD', 'SYPUSD', 'THBUSD', 'TRYUSD', 'TWDUSD', 'UAHUSD', 'UYUUSD', 'VNDUSD', 'XBRUSD', 'ZARUSD', 'BRLAUD', 'EURAUD', 'USDAUD', 'BRLCAD', 'EURCAD', 'USDCAD', 'EURBSD', 'USDBSD', 'EURKYD', 'BRLBBD', 'EURBBD', 'USDBBD', 'EURBZD', 'USDBZD', 'EURBND', 'USDBND', 'BRLSGD', 'EURSGD', 'USDSGD', 'EURFJD', 'USDFJD', 'BRLHKD', 'EURHKD', 'USDHKD', 'EURTTD', 'USDTTD', 'BRLXCD', 'EURXCD', 'USDXCD', 'BRLJMD', 'EURJMD', 'USDJMD', 'BRLNAD', 'EURNAD', 'USDNAD', 'BRLNZD', 'EURNZD', 'USDNZD', 'BRLTWD', 'EURTWD', 'USDTWD', 'USDZWL', 'EURVND', 'USDVND', 'EURAMD', 'USDAMD', 'EURCVE', 'AEDEUR', 'ARSEUR', 'AUDEUR', 'BHDEUR', 'BRLEUR', 'BYNEUR', 'CADEUR', 'CHFEUR', 'CNYEUR', 'DKKEUR', 'EGPEUR', 'GBPEUR', 'GELEUR', 'GHSEUR', 'HKDEUR', 'HUFEUR', 'IDREUR', 'ILSEUR', 'INREUR', 'JODEUR', 'JPYEUR', 'KRWEUR', 'KWDEUR', 'MADEUR', 'MXNEUR', 'NOKEUR', 'NZDEUR', 'PENEUR', 'PLNEUR', 'RUBEUR', 'SAREUR', 'SEKEUR', 'SGDEUR', 'TRYEUR', 'TWDEUR', 'USDEUR', 'ZAREUR', 'BRLHUF', 'EURHUF', 'USDHUF', 'EURBIF', 'USDBIF', 'BRLXAF', 'EURXAF', 'USDXAF', 'BRLXOF', 'EURXOF', 'USDXOF', 'EURXPF', 'USDXPF', 'USDKMF', 'EURGNF', 'USDGNF', 'EURDJF', 'EURRWF', 'USDRWF', 'BRLCHF', 'EURCHF', 'USDCHF', 'EURHTG', 'USDHTG', 'BRLPYG', 'EURPYG', 'USDPYG', 'EURANG', 'USDANG', 'EURUAH', 'USDUAH', 'BRLJPY', 'EURJPY', 'USDJPY', 'EURPGK', 'USDPGK', 'EURLAK', 'USDLAK', 'EURHRK', 'USDHRK', 'EURMWK', 'USDMWK', 'EURZMK', 'USDZMK', 'EURAOA', 'USDAOA', 'EURMMK', 'USDMMK', 'EURGEL', 'USDGEL', 'EURALL', 'USDALL', 'EURHNL', 'USDHNL', 'EURMDL', 'USDMDL', 'BRLRON', 'EURRON', 'USDRON', 'EURBGN', 'USDBGN', 'BRLEGP', 'EUREGP', 'USDEGP', 'BRLGBP', 'EURGBP', 'USDGBP', 'BRLLBP', 'EURLBP', 'USDLBP', 'EURSYP', 'USDSYP', 'EURSDG', 'USDSDG', 'EURSZL', 'USDSZL', 'EURLSL', 'USDLSL', 'EURAZN', 'USDAZN', 'EURBAM', 'EURMZN', 'USDMZN', 'USDMNT', 'EURNGN', 'USDNGN', 'USDNGNI', 'BRLTRY', 'EURTRY', 'USDTRY', 'BRLILS', 'EURILS', 'USDILS', 'EURMRO', 'EURMOP', 'USDMOP', 'BRLARS', 'EURARS', 'USDARS', 'BRLCLP', 'EURCLP', 'USDCLP', 'BRLCOP', 'EURCOP', 'USDCOP', 'EURCUP', 'USDCUP', 'EURDOP', 'USDDOP', 'BRLPHP', 'EURPHP', 'USDPHP', 'BRLMXN', 'EURMXN', 'USDMXN', 'BRLUYU', 'EURUYU', 'USDUYU', 'EURBWP', 'USDBWP', 'EURGTQ', 'USDGTQ', 'BRLZAR', 'EURZAR', 'USDZAR', 'AEDBRL', 'ARSBRL', 'AUDBRL', 'BOBBRL', 'CADBRL', 'CHFBRL', 'CLPBRL', 'CNYBRL', 'COPBRL', 'DKKBRL', 'EURBRL', 'GBPBRL', 'HKDBRL', 'ILSBRL', 'INRBRL', 'JPYBRL', 'MXNBRL', 'NOKBRL', 'NZDBRL', 'PENBRL', 'PLNBRL', 'PYGBRL', 'RUBBRL', 'SARBRL', 'SEKBRL', 'SGDBRL', 'THBBRL', 'TRYBRL', 'TWDBRL', 'USDBRL', 'UYUBRL', 'ZARBRL', 'USDBRLT', 'BRLQAR', 'EURQAR', 'USDQAR', 'EURIRR', 'USDIRR', 'BRLOMR', 'EUROMR', 'USDOMR', 'EURKHR', 'USDKHR', 'BRLMYR', 'EURMYR', 'USDMYR', 'USDYER', 'BRLSAR', 'EURSAR', 'USDSAR', 'EURBYN', 'USDBYN', 'BRLRUB', 'EURRUB', 'USDRUB', 'USDMVR', 'BRLLKR', 'EURLKR', 'USDLKR', 'BRLINR', 'EURINR', 'USDINR', 'BRLIDR', 'EURIDR', 'USDIDR', 'EURMUR', 'USDMUR', 'BRLNPR', 'EURNPR', 'USDNPR', 'BRLPKR', 'EURPKR', 'USDPKR', 'EURSCR', 'USDSCR', 'BRLKES', 'EURKES', 'USDKES', 'EURSOS', 'USDSOS', 'EURTZS', 'USDTZS', 'EURUGX', 'USDUGX', 'BRLPEN', 'EURPEN', 'USDPEN', 'USDKGS', 'EURUZS', 'USDUZS', 'EURTJS', 'USDTJS', 'EURBDT', 'USDBDT', 'EURKZT', 'USDKZT', 'USDVUV', 'BRLKRW', 'EURKRW', 'USDKRW', 'BRLCNY', 'EURCNY', 'USDCNY', 'USDCNH', 'BRLPLN', 'EURPLN', 'USDPLN']
codes = ['AFN', 'MGA', 'THB', 'PAB', 'ETB', 'BOB', 'VEF', 'XBR', 'GHS', 'SVC', 'CRC', 'CZK', 'DKK', 'ISK', 'NOK', 'SEK', 'NIO', 'GMD', 'MKD', 'DZD', 'IQD', 'JOD', 'KWD', 'LYD', 'RSD', 'TND', 'BHD', 'MAD', 'AED', 'STD', 'VND', 'AMD', 'USD', 'AUD', 'CAD', 'JMD', 'NAD', 'NZD', 'TWD', 'ZWL', 'BSD', 'KYD', 'BBD', 'BZD', 'BND', 'SGD', 'FJD', 'HKD', 'TTD', 'XCD', 'CVE', 'EUR', 'HUF', 'BIF', 'XAF', 'XOF', 'XPF', 'KMF', 'RWF', 'CHF', 'CHFRTS', 'GNF', 'DJF', 'HTG', 'PYG', 'ANG', 'UAH', 'JPY', 'JPYRTS', 'PGK', 'LAK', 'HRK', 'MWK', 'ZMK', 'AOA', 'MMK', 'GEL', 'ALL', 'HNL', 'MDL', 'RON', 'BGN', 'EGP', 'GBP', 'LBP', 'SDG', 'SYP', 'SZL', 'LSL', 'AZN', 'BAM', 'MZN', 'MNT', 'NGN', 'NGNI', 'NGNPARALLEL', 'TRY', 'ILS', 'MRO', 'MOP', 'ARS', 'CLP', 'COP', 'CUP', 'DOP', 'PHP', 'MXN', 'UYU', 'BWP', 'GTQ', 'ZAR', 'BRL', 'BRLT', 'QAR', 'IRR', 'OMR', 'KHR', 'MYR', 'YER', 'SAR', 'BYN', 'RUB', 'RUBTOM', 'RUBTOD', 'MVR', 'IDR', 'INR', 'MUR', 'NPR', 'PKR', 'LKR', 'SCR', 'KES', 'SOS', 'TZS', 'UGX', 'PEN', 'KGS', 'UZS', 'TJS', 'BDT', 'KZT', 'VUV', 'KRW', 'CNY', 'CNH', 'PLN']
currency_info = [{'code': 'AFN', 'name': 'Afghani do Afeganistão', 'country_region': 'Afeganistão'}, {'code': 'MGA', 'name': 'Ariary Madagascarense', 'country_region': 'Madagascar'}, {'code': 'THB', 'name': 'Baht Tailandês', 'country_region': 'Tailândia'}, {'code': 'PAB', 'name': 'Balboa Panamenho', 'country_region': 'Panamá'}, {'code': 'ETB', 'name': 'Birr Etíope', 'country_region': 'Etiópia'}, {'code': 'BOB', 'name': 'Boliviano', 'country_region': 'Bolívia'}, {'code': 'VEF', 'name': 'Bolívar Venezuelano', 'country_region': 'Venezuela'}, {'code': 'XBR', 'name': 'Brent Spot', 'country_region': 'Petróleo'}, {'code': 'GHS', 'name': 'Cedi Ganês', 'country_region': 'Gana'}, {'code': 'SVC', 'name': 'Colon de El Salvador', 'country_region': 'El Salvador'}, {'code': 'CRC', 'name': 'Colón Costarriquenho', 'country_region': 'Costa Rica'}, {'code': 'CZK', 'name': 'Coroa Checa', 'country_region': 'República Checa'}, {'code': 'DKK', 'name': 'Coroa Dinamarquesa', 'country_region': 'Dinamarca'}, {'code': 'ISK', 'name': 'Coroa Islandesa', 'country_region': 'Islândia'}, {'code': 'NOK', 'name': 'Coroa Norueguesa', 'country_region': 'Noruega'}, {'code': 'SEK', 'name': 'Coroa Sueca', 'country_region': 'Suécia'}, {'code': 'NIO', 'name': 'Córdoba Nicaraguense', 'country_region': 'Nicarágua'}, {'code': 'GMD', 'name': 'Dalasi da Gâmbia', 'country_region': 'Gâmbia'}, {'code': 'MKD', 'name': 'Denar Macedônio', 'country_region': 'Macedônia'}, {'code': 'DZD', 'name': 'Dinar Argelino', 'country_region': 'Argélia'}, {'code': 'IQD', 'name': 'Dinar Iraquiano', 'country_region': 'Iraque'}, {'code': 'JOD', 'name': 'Dinar Jordaniano', 'country_region': 'Jordânia'}, {'code': 'KWD', 'name': 'Dinar Kuwaitiano', 'country_region': 'Kuwait'}, {'code': 'LYD', 'name': 'Dinar Líbio', 'country_region': 'Líbia'}, {'code': 'RSD', 'name': 'Dinar Sérvio', 'country_region': 'Servia'}, {'code': 'TND', 'name': 'Dinar Tunisiano', 'country_region': 'Tunísia'}, {'code': 'BHD', 'name': 'Dinar do Bahrein', 'country_region': 'Bahrein'}, {'code': 'MAD', 'name': 'Dirham Marroquino', 'country_region': 'Marrocos'}, {'code': 'AED', 'name': 'Dirham dos Emirados', 'country_region': 'Emirados Árabes Unidos'}, {'code': 'STD', 'name': 'Dobra São Tomé/Príncipe', 'country_region': 'São Tomé e Príncipe'}, {'code': 'VND', 'name': 'Dong Vietnamita', 'country_region': 'Vietnã'}, {'code': 'AMD', 'name': 'Dram Armênio', 'country_region': 'Armênia'}, {'code': 'USD', 'name': 'Dólar Americano', 'country_region': 'Estados Unidos'}, {'code': 'AUD', 'name': 'Dólar Australiano', 'country_region': 'Austrália'}, {'code': 'CAD', 'name': 'Dólar Canadense', 'country_region': 'Canadá'}, {'code': 'JMD', 'name': 'Dólar Jamaicano', 'country_region': 'Jamaica'}, {'code': 'NAD', 'name': 'Dólar Namíbio', 'country_region': 'Namíbia'}, {'code': 'NZD', 'name': 'Dólar Neozelandês', 'country_region': 'Nova Zelândia'}, {'code': 'TWD', 'name': 'Dólar Taiuanês', 'country_region': 'Taiwan'}, {'code': 'ZWL', 'name': 'Dólar Zimbabuense', 'country_region': 'Zimbabué'}, {'code': 'BSD', 'name': 'Dólar das Bahamas', 'country_region': 'Bahamas'}, {'code': 'KYD', 'name': 'Dólar das Ilhas Cayman', 'country_region': 'Ilhas Cayman'}, {'code': 'BBD', 'name': 'Dólar de Barbados', 'country_region': 'Barbados'}, {'code': 'BZD', 'name': 'Dólar de Belize', 'country_region': 'Belize'}, {'code': 'BND', 'name': 'Dólar de Brunei', 'country_region': 'Brunei'}, {'code': 'SGD', 'name': 'Dólar de Cingapura', 'country_region': 'Cingapura'}, {'code': 'FJD', 'name': 'Dólar de Fiji', 'country_region': 'Fiji'}, {'code': 'HKD', 'name': 'Dólar de Hong Kong', 'country_region': 'Hong Kong'}, {'code': 'TTD', 'name': 'Dólar de Trinidad', 'country_region': 'Trinidade e Tobago'}, {'code': 'XCD', 'name': 'Dólar do Caribe Oriental', 'country_region': 'Caribe'}, {'code': 'CVE', 'name': 'Escudo cabo-verdiano', 'country_region': 'Cabo Verde'}, {'code': 'EUR', 'name': 'Euro', 'country_region': 'União Europeia'}, {'code': 'HUF', 'name': 'Florim Húngaro', 'country_region': 'Hungria'}, {'code': 'BIF', 'name': 'Franco Burundinense', 'country_region': 'Burundi'}, {'code': 'XAF', 'name': 'Franco CFA Central', 'country_region': 'África Central'}, {'code': 'XOF', 'name': 'Franco CFA Ocidental', 'country_region': 'África Ocidental'}, {'code': 'XPF', 'name': 'Franco CFP', 'country_region': 'Territórios Franceses do Pacífico'}, {'code': 'KMF', 'name': 'Franco Comorense', 'country_region': 'Comores'}, {'code': 'RWF', 'name': 'Franco Ruandês', 'country_region': 'Ruanda'}, {'code': 'CHF', 'name': 'Franco Suíço', 'country_region': 'Suíça'}, {'code': 'CHFRTS', 'name': 'Franco Suíço', 'country_region': 'Suíça'}, {'code': 'GNF', 'name': 'Franco de Guiné', 'country_region': 'Guiné'}, {'code': 'DJF', 'name': 'Franco do Djibouti', 'country_region': 'Djibouti'}, {'code': 'HTG', 'name': 'Gourde Haitiano', 'country_region': 'Haiti'}, {'code': 'PYG', 'name': 'Guarani Paraguaio', 'country_region': 'Paraguai'}, {'code': 'ANG', 'name': 'Guilder das Antilhas', 'country_region': 'Antilhas Holandesas'}, {'code': 'UAH', 'name': 'Hryvinia Ucraniana', 'country_region': 'Ucrânia'}, {'code': 'JPY', 'name': 'Iene Japonês', 'country_region': 'Japão'}, {'code': 'JPYRTS', 'name': 'Iene Japonês', 'country_region': 'Japão'}, {'code': 'PGK', 'name': 'Kina Papua-Nova Guiné', 'country_region': 'Papua-Nova Guiné'}, {'code': 'LAK', 'name': 'Kip Laosiano', 'country_region': 'Laos'}, {'code': 'HRK', 'name': 'Kuna Croata', 'country_region': 'Croácia'}, {'code': 'MWK', 'name': 'Kwacha Malauiana', 'country_region': 'República do Malauí'}, {'code': 'ZMK', 'name': 'Kwacha Zambiana', 'country_region': 'Zâmbia'}, {'code': 'AOA', 'name': 'Kwanza Angolano', 'country_region': 'Ângola'}, {'code': 'MMK', 'name': 'Kyat de Mianmar', 'country_region': 'Mianmar'}, {'code': 'GEL', 'name': 'Lari Georgiano', 'country_region': 'Geórgia'}, {'code': 'ALL', 'name': 'Lek Albanês', 'country_region': 'Albânia'}, {'code': 'HNL', 'name': 'Lempira Hondurenha', 'country_region': 'Honduras'}, {'code': 'MDL', 'name': 'Leu Moldavo', 'country_region': 'Moldávia'}, {'code': 'RON', 'name': 'Leu Romeno', 'country_region': 'Romênia'}, {'code': 'BGN', 'name': 'Lev Búlgaro', 'country_region': 'Bulgária'}, {'code': 'EGP', 'name': 'Libra Egípcia', 'country_region': 'Egito'}, {'code': 'GBP', 'name': 'Libra Esterlina', 'country_region': 'Grã-Bretanha'}, {'code': 'LBP', 'name': 'Libra Libanesa', 'country_region': 'Libano'}, {'code': 'SDG', 'name': 'Libra Sudanesa', 'country_region': 'Sudão'}, {'code': 'SYP', 'name': 'Libra Síria', 'country_region': 'Síria'}, {'code': 'SZL', 'name': 'Lilangeni de Essuatíni', 'country_region': 'Essuatíni'}, {'code': 'LSL', 'name': 'Loti do Lesoto', 'country_region': 'Lesoto'}, {'code': 'AZN', 'name': 'Manat Azeri', 'country_region': 'Azerbaijão'}, {'code': 'BAM', 'name': 'Marco Conversível', 'country_region': 'Bósnia e Herzegovina'}, {'code': 'MZN', 'name': 'Metical de Moçambique', 'country_region': 'Moçambique'}, {'code': 'MNT', 'name': 'Tugrik da Mongólia', 'country_region': 'Mongólia'}, {'code': 'NGN', 'name': 'Naira Nigeriana', 'country_region': 'Nigéria'}, {'code': 'NGNI', 'name': 'Naira Nigeriana', 'country_region': 'Nigéria'}, {'code': 'NGNPARALLEL', 'name': 'Naira Nigeriana', 'country_region': 'Nigéria'}, {'code': 'TRY', 'name': 'Nova Lira Turca', 'country_region': 'Turquia'}, {'code': 'ILS', 'name': 'Novo Shekel Israelense', 'country_region': 'Israel'}, {'code': 'MRO', 'name': 'Ouguiya Mauritana', 'country_region': 'Mauritânia'}, {'code': 'MOP', 'name': 'Pataca de Macau', 'country_region': 'Macau'}, {'code': 'ARS', 'name': 'Peso Argentino', 'country_region': 'Argentina'}, {'code': 'CLP', 'name': 'Peso Chileno', 'country_region': 'Chile'}, {'code': 'COP', 'name': 'Peso Colombiano', 'country_region': 'Colômbia'}, {'code': 'CUP', 'name': 'Peso Cubano', 'country_region': 'Cuba'}, {'code': 'DOP', 'name': 'Peso Dominicano', 'country_region': 'República Dominicana'}, {'code': 'PHP', 'name': 'Peso Filipino', 'country_region': 'Filipinas'}, {'code': 'MXN', 'name': 'Peso Mexicano', 'country_region': 'México'}, {'code': 'UYU', 'name': 'Peso Uruguaio', 'country_region': 'Uruguai'}, {'code': 'BWP', 'name': 'Pula de Botswana', 'country_region': 'Botswana'}, {'code': 'GTQ', 'name': 'Quetzal Guatemalteco', 'country_region': 'Guatemala'}, {'code': 'ZAR', 'name': 'Rand Sul-Africano', 'country_region': 'África do Sul'}, {'code': 'BRL', 'name': 'Real Brasileiro', 'country_region': 'Brasil'}, {'code': 'BRLT', 'name': 'Real Brasileiro Turismo', 'country_region': 'Brasil'}, {'code': 'QAR', 'name': 'Rial Catarense', 'country_region': 'Catar'}, {'code': 'IRR', 'name': 'Rial Iraniano', 'country_region': 'Irã'}, {'code': 'OMR', 'name': 'Rial Omanense', 'country_region': 'Omã'}, {'code': 'KHR', 'name': 'Riel Cambojano', 'country_region': 'Camboja'}, {'code': 'MYR', 'name': 'Ringgit Malaio', 'country_region': 'Malásia'}, {'code': 'YER', 'name': 'Riyal Iemenita', 'country_region': 'Iêmen'}, {'code': 'SAR', 'name': 'Riyal Saudita', 'country_region': 'Arábia Saudita'}, {'code': 'BYN', 'name': 'Rublo Bielorrusso', 'country_region': 'Bielorrússia'}, {'code': 'RUB', 'name': 'Rublo Russo', 'country_region': 'Rússia'}, {'code': 'RUBTOM', 'name': 'Rublo Russo', 'country_region': 'Rússia'}, {'code': 'RUBTOD', 'name': 'Rublo Russo', 'country_region': 'Rússia'}, {'code': 'MVR', 'name': 'Rufiyaa Maldiva', 'country_region': 'Maldivas'}, {'code': 'IDR', 'name': 'Rupia Indonésia', 'country_region': 'Indonésia'}, {'code': 'INR', 'name': 'Rúpia Indiana', 'country_region': 'Índia'}, {'code': 'MUR', 'name': 'Rúpia Mauriciana', 'country_region': 'Maurícia'}, {'code': 'NPR', 'name': 'Rúpia Nepalesa', 'country_region': 'Nepal'}, {'code': 'PKR', 'name': 'Rúpia Paquistanesa', 'country_region': 'Paquistão'}, {'code': 'LKR', 'name': 'Rúpia de Sri Lanka', 'country_region': 'Sri Lanka'}, {'code': 'SCR', 'name': 'Rúpias de Seicheles', 'country_region': 'Seicheles'}, {'code': 'KES', 'name': 'Shilling Queniano', 'country_region': 'Quênia'}, {'code': 'SOS', 'name': 'Shilling Somaliano', 'country_region': 'Somália'}, {'code': 'TZS', 'name': 'Shilling Tanzaniano', 'country_region': 'Tanzânia'}, {'code': 'UGX', 'name': 'Shilling Ugandês', 'country_region': 'Uganda'}, {'code': 'PEN', 'name': 'Sol do Peru', 'country_region': 'Peru'}, {'code': 'KGS', 'name': 'Som Quirguistanês', 'country_region': 'Quirguistão'}, {'code': 'UZS', 'name': 'Som Uzbequistanês', 'country_region': 'Uzbequistão'}, {'code': 'TJS', 'name': 'Somoni do Tajiquistão', 'country_region': 'Tajiquistão'}, {'code': 'BDT', 'name': 'Taka de Bangladesh', 'country_region': 'Bangladesh'}, {'code': 'KZT', 'name': 'Tengue Cazaquistanês', 'country_region': 'Cazaquistão'}, {'code': 'VUV', 'name': 'Vatu de Vanuatu', 'country_region': 'Vanuatu'}, {'code': 'KRW', 'name': 'Won Sul-Coreano', 'country_region': 'Coreia do Sul'}, {'code': 'CNY', 'name': 'Yuan Chinês', 'country_region': 'China'}, {'code': 'CNH', 'name': 'Yuan chinês offshore', 'country_region': 'China'}, {'code': 'PLN', 'name': 'Zlóti Polonês', 'country_region': 'Polônia'}]
name = ['Afghani do Afeganistão', 'Ariary Madagascarense', 'Baht Tailandês', 'Balboa Panamenho', 'Birr Etíope', 'Boliviano', 'Bolívar Venezuelano', 'Brent Spot', 'Cedi Ganês', 'Colon de El Salvador', 'Colón Costarriquenho', 'Coroa Checa', 'Coroa Dinamarquesa', 'Coroa Islandesa', 'Coroa Norueguesa', 'Coroa Sueca', 'Córdoba Nicaraguense', 'Dalasi da Gâmbia', 'Denar Macedônio', 'Dinar Argelino', 'Dinar Iraquiano', 'Dinar Jordaniano', 'Dinar Kuwaitiano', 'Dinar Líbio', 'Dinar Sérvio', 'Dinar Tunisiano', 'Dinar do Bahrein', 'Dirham Marroquino', 'Dirham dos Emirados', 'Dobra São Tomé/Príncipe', 'Dong Vietnamita', 'Dram Armênio', 'Dólar Americano', 'Dólar Australiano', 'Dólar Canadense', 'Dólar Jamaicano', 'Dólar Namíbio', 'Dólar Neozelandês', 'Dólar Taiuanês', 'Dólar Zimbabuense', 'Dólar das Bahamas', 'Dólar das Ilhas Cayman', 'Dólar de Barbados', 'Dólar de Belize', 'Dólar de Brunei', 'Dólar de Cingapura', 'Dólar de Fiji', 'Dólar de Hong Kong', 'Dólar de Trinidad', 'Dólar do Caribe Oriental', 'Escudo cabo-verdiano', 'Euro', 'Florim Húngaro', 'Franco Burundinense', 'Franco CFA Central', 'Franco CFA Ocidental', 'Franco CFP', 'Franco Comorense', 'Franco Ruandês', 'Franco Suíço', 'Franco Suíço', 'Franco de Guiné', 'Franco do Djibouti', 'Gourde Haitiano', 'Guarani Paraguaio', 'Guilder das Antilhas', 'Hryvinia Ucraniana', 'Iene Japonês', 'Iene Japonês', 'Kina Papua-Nova Guiné', 'Kip Laosiano', 'Kuna Croata', 'Kwacha Malauiana', 'Kwacha Zambiana', 'Kwanza Angolano', 'Kyat de Mianmar', 'Lari Georgiano', 'Lek Albanês', 'Lempira Hondurenha', 'Leu Moldavo', 'Leu Romeno', 'Lev Búlgaro', 'Libra Egípcia', 'Libra Esterlina', 'Libra Libanesa', 'Libra Sudanesa', 'Libra Síria', 'Lilangeni de Essuatíni', 'Loti do Lesoto', 'Manat Azeri', 'Marco Conversível', 'Metical de Moçambique', 'Tugrik da Mongólia', 'Naira Nigeriana', 'Naira Nigeriana', 'Naira Nigeriana', 'Nova Lira Turca', 'Novo Shekel Israelense', 'Ouguiya Mauritana', 'Pataca de Macau', 'Peso Argentino', 'Peso Chileno', 'Peso Colombiano', 'Peso Cubano', 'Peso Dominicano', 'Peso Filipino', 'Peso Mexicano', 'Peso Uruguaio', 'Pula de Botswana', 'Quetzal Guatemalteco', 'Rand Sul-Africano', 'Real Brasileiro', 'Real Brasileiro Turismo', 'Rial Catarense', 'Rial Iraniano', 'Rial Omanense', 'Riel Cambojano', 'Ringgit Malaio', 'Riyal Iemenita', 'Riyal Saudita', 'Rublo Bielorrusso', 'Rublo Russo', 'Rublo Russo', 'Rublo Russo', 'Rufiyaa Maldiva', 'Rupia Indonésia', 'Rúpia Indiana', 'Rúpia Mauriciana', 'Rúpia Nepalesa', 'Rúpia Paquistanesa', 'Rúpia de Sri Lanka', 'Rúpias de Seicheles', 'Shilling Queniano', 'Shilling Somaliano', 'Shilling Tanzaniano', 'Shilling Ugandês', 'Sol do Peru', 'Som Quirguistanês', 'Som Uzbequistanês', 'Somoni do Tajiquistão', 'Taka de Bangladesh', 'Tengue Cazaquistanês', 'Vatu de Vanuatu', 'Won Sul-Coreano', 'Yuan Chinês', 'Yuan chinês offshore', 'Zlóti Polonês']
country_region = ['Afeganistão', 'Madagascar', 'Tailândia', 'Panamá', 'Etiópia', 'Bolívia', 'Venezuela', 'Petróleo', 'Gana', 'El Salvador', 'Costa Rica', 'República Checa', 'Dinamarca', 'Islândia', 'Noruega', 'Suécia', 'Nicarágua', 'Gâmbia', 'Macedônia', 'Argélia', 'Iraque', 'Jordânia', 'Kuwait', 'Líbia', 'Servia', 'Tunísia', 'Bahrein', 'Marrocos', 'Emirados Árabes Unidos', 'São Tomé e Príncipe', 'Vietnã', 'Armênia', 'Estados Unidos', 'Austrália', 'Canadá', 'Jamaica', 'Namíbia', 'Nova Zelândia', 'Taiwan', 'Zimbabué', 'Bahamas', 'Ilhas Cayman', 'Barbados', 'Belize', 'Brunei', 'Cingapura', 'Fiji', 'Hong Kong', 'Trinidade e Tobago', 'Caribe', 'Cabo Verde', 'União Europeia', 'Hungria', 'Burundi', 'África Central', 'África Ocidental', 'Territórios Franceses do Pacífico', 'Comores', 'Ruanda', 'Suíça', 'Suíça', 'Guiné', 'Djibouti', 'Haiti', 'Paraguai', 'Antilhas Holandesas', 'Ucrânia', 'Japão', 'Japão', 'Papua-Nova Guiné', 'Laos', 'Croácia', 'República do Malauí', 'Zâmbia', 'Ângola', 'Mianmar', 'Geórgia', 'Albânia', 'Honduras', 'Moldávia', 'Romênia', 'Bulgária', 'Egito', 'Grã-Bretanha', 'Libano', 'Sudão', 'Síria', 'Essuatíni', 'Lesoto', 'Azerbaijão', 'Bósnia e Herzegovina', 'Moçambique', 'Mongólia', 'Nigéria', 'Nigéria', 'Nigéria', 'Turquia', 'Israel', 'Mauritânia', 'Macau', 'Argentina', 'Chile', 'Colômbia', 'Cuba', 'República Dominicana', 'Filipinas', 'México', 'Uruguai', 'Botswana', 'Guatemala', 'África do Sul', 'Brasil', 'Brasil', 'Catar', 'Irã', 'Omã', 'Camboja', 'Malásia', 'Iêmen', 'Arábia Saudita', 'Bielorrússia', 'Rússia', 'Rússia', 'Rússia', 'Maldivas', 'Indonésia', 'Índia', 'Maurícia', 'Nepal', 'Paquistão', 'Sri Lanka', 'Seicheles', 'Quênia', 'Somália', 'Tanzânia', 'Uganda', 'Peru', 'Quirguistão', 'Uzbequistão', 'Tajiquistão', 'Bangladesh', 'Cazaquistão', 'Vanuatu', 'Coreia do Sul', 'China', 'China', 'Polônia']

url_raw = 'https://economia.awesomeapi.com.br/json/last/'
pairs_joined = ','.join(currency_pairs)
url = url_raw + pairs_joined


crypto_currency_info = [
        {'code': 'USD', 'country_region': 'Estados Unidos'},
        {'code': 'EUR', 'country_region': 'União Europeia'},
        {'code': 'BRL', 'country_region': 'Brasil'}
    ]

# CoinGecko Instance
cg = CoinGeckoAPI()


@shared_task
def update_cryptocurrency():
    try:
        date_now = now()
        crypto_usd = cg.get_coins_markets(vs_currency='USD')
        crypto_brl = cg.get_coins_markets(vs_currency='BRL')
        crypto_eur = cg.get_coins_markets(vs_currency='EUR')

        if (crypto_brl and crypto_usd and crypto_eur):
            
            for crypto_item in crypto_usd:
                cryptocurrencies_usd = Cryptocurrency(
                    date=date_now,
                    name=crypto_item['name'],
                    symbol=crypto_item['symbol'],
                    to_country_region=crypto_currency_info[0]['country_region'],
                    to_currency_code=crypto_currency_info[0]['code'],
                    market_cap=crypto_item['market_cap'],
                    circulating_supply=crypto_item['circulating_supply'],
                    max_supply=crypto_item['max_supply'],
                    value=crypto_item['current_price'],
                    source='CoinGecko'
                )
                cryptocurrencies_usd.save()
            

            for crypto_item in crypto_eur:
                cryptocurrencies_eur = Cryptocurrency(
                    date=date_now,
                    name=crypto_item['name'],
                    symbol=crypto_item['symbol'],
                    to_country_region=crypto_currency_info[1]['country_region'],
                    to_currency_code=crypto_currency_info[1]['code'],
                    market_cap=crypto_item['market_cap'],
                    circulating_supply=crypto_item['circulating_supply'],
                    max_supply=crypto_item['max_supply'],
                    value=crypto_item['current_price'],
                    source='CoinGecko'
                )
                cryptocurrencies_eur.save()

            for crypto_item in crypto_brl:
                cryptocurrencies_brl = Cryptocurrency(
                    date=date_now,
                    name=crypto_item['name'],
                    symbol=crypto_item['symbol'],
                    to_country_region=crypto_currency_info[2]['country_region'],
                    to_currency_code=crypto_currency_info[2]['code'],
                    market_cap=crypto_item['market_cap'],
                    circulating_supply=crypto_item['circulating_supply'],
                    max_supply=crypto_item['max_supply'],
                    value=crypto_item['current_price'],
                    source='CoinGecko'
                )
                cryptocurrencies_brl.save()
            cryptocurrencies = Cryptocurrency.objects.filter(date__lte=(now()-timedelta(minutes=5)))
            cryptocurrencies.delete()

            return 'Cryptocurrency data updated.'

    except ConnectionError:
        return 'Cryptocurrency data update failed.'


@shared_task
def update_currency():
    try:
        response = requests.get(url)
        json = response.json()
        date_now = now()

        if (response.status_code == 200):

            for pair in code_pairs:
                currency_item = Currency(
                    date=date_now,
                    name=json[pair]['name'][0:json[pair]['name'].index('/')],
                    from_country_region=currency_info[[c['code'] == json[pair]['code'] for c in currency_info].index(True)]['country_region'],
                    to_country_region=currency_info[[c['code'] == json[pair]['codein'] for c in currency_info].index(True)]['country_region'],
                    from_currency_code=json[pair]['code'],
                    to_currency_code=json[pair]['codein'],
                    value=json[pair]['ask'],
                    source='AwesomeAPI'
                )
                currency_item.save()
            currencies = Currency.objects.filter(date__lte=(now() - timedelta(minutes=5)))
            currencies.delete()

            return 'Currency data updated.'

    except ConnectionError:
        return 'Currency data update failed.'